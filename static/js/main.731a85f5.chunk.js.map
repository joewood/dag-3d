{"version":3,"sources":["kafka.svg","component/messages.tsx","component/edge.tsx","three-utils/text.tsx","component/node.tsx","three-utils/use-spring-3d.ts","three-utils/camera-rig.tsx","graph/use-graph-viewport.ts","three-utils/svg-mesh.tsx","component/broker-queue.tsx","graph/graph.tsx","demo-graph.tsx","graph/nlayout-graph.ts","component/record-stream.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["module","exports","EdgeMessages","prefix","curve","elapsed","messages","duration","messageMeshes","useMemo","map","message","key","messageKey","position","getPointAt","Math","max","min","frame","color","messageMesh","i","attach","args","Edge","fromNode","toNode","points","onEgress","_onEgress","useCallback","useState","elapsedMs","setElapsedMs","useFrame","clock","elapsedTime","messagesBuffered","messagePump","undefined","setMessages","useEffect","length","msg","unexpiredMessages","m","filter","expiredMessages","emptyArray","keyed","keyBy","useTrackMessages","CatmullRomCurve3","usePath","stepFunction","v","neg","abs","generateTopUV","geometry","vertices","indexA","indexB","indexC","rear","a_x","a_y","b_x","b_y","c_x","c_y","Vector2","generateSideWallUV","indexD","depth","options","curves","shapes","mX","reduce","p","c","v1","x","v2","Number","MAX_SAFE_INTEGER","MIN_SAFE_INTEGER","mY","y","mZ","ofMax","a_z","b_z","c_z","d_y","d_z","right","Text","forwardRef","ref","width","height","text","backgroundColor","onClick","props","_width","_height","_text","shape","__shape","Shape","moveTo","lineTo","extrudeSettings","steps","bevelEnabled","bevelThickness","bevelSize","bevelOffset","bevelSegments","UVGenerator","textCanvas","canvas","document","createElement","context","getContext","textureWidth","textureHeight","style","top","scale","fillStyle","fillRect","fontSize","font","textAlign","textBaseline","fillText","_onClick","roughness","metalness","attachArray","image","useCheckMessages","setElpased","floor","defaultProps","Label","name","onSelect","useRef","_onSelect","current","mesh","pos","Vector3","z","Edges","edges","edge","Node","edgeProps","useEdges","useVel","initial","target","damper","spring","vel","state","set","onFrame","Controls","controls","useThree","gl","camera","update","domElement","enableDamping","dampingFactor","rotateSpeed","extend","OrbitControls","CameraRig","targetPosition","distance","orbit","rotate","t","getElapsedTime","PI","cos","sin","camPosS","camPos","camLookAt","lookAt","useCameraPan","scaleToFit3","midGraph","scaleFactor","scalePoint","graph","viewportWidth","viewportHeight","useScaleFactor","viewport","maxGraph","SvgMeshPath","drawFillShapes","fillShapesWireframe","drawStrokes","strokesWireframe","path","fillMat","strokeMat","userData","fill","Color","setStyle","opacity","fillOpacity","transparent","toString","side","DoubleSide","depthWrite","wireframe","toShapes","stroke","strokeOpacity","subPaths","subPath","SVGLoader","pointsToStroke","getPoints","material","SvgMesh","url","svgData","setSvgData","load","result","setX","paths","BrokerQueueNode","logo","Graph","onSelectNode","selectedNode","feed","messageState","setMessageState","f","to","count","scaledGraph","nodes","node","type","from","useGraphViewPort","edgesPerNode","groupBy","e","selectedNodeIndex","index","findIndex","DemoGraph","pumpProducer","pumpValue","setNode","selectedMesh","setMesh","createGraph","n","addNode","addLink","layout","layout3d","gravity","setNodePosition","random","step","retnodes","getNodePosition","retEdges","fromPos","toPos","getNode","data","mid","delta","connectPoint","output","midp","fromPoint","toPoint","fromHose","toHose","getGraphRect","x1","x2","y1","y2","z1","z2","useNgraph","light1","light2","light3","light4","lightHelper1","lightHelper2","lightHelper3","lightHelper4","unselect","pixelRatio","window","devicePixelRatio","onClickCapture","intensity","RecordStream","filename","downloadUrl","setDownloadUrl","recorder","setRecorder","videoRef","onsStart","a","recData","navigator","mediaDevices","getDisplayMedia","video","audio","stream","srcObject","currRec","MediaRecorder","mimeType","ondataavailable","push","onstop","blob","Blob","URL","createObjectURL","start","doit","onStop","stop","padding","display","href","download","commonNode","weight","buttonStyle","fontWeight","margin","App","pump","setPump","setOrbit","pump1","id","pump2","pump3","orbitChange","console","log","checked","className","onChange","data-on","data-off","Boolean","location","hostname","match","ReactDOM","render","getElementById","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.731a85f5.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/kafka.78638322.svg\";","import React, { FC, useMemo } from \"react\";\nimport { CatmullRomCurve3 } from \"three\";\n\nexport interface MessageProps {\n    messageKey: string;\n    value?: number;\n    content?: string;\n}\n\nexport interface MessageArrived extends MessageProps {\n    frame: number;\n}\n\ninterface EdgeMessagesProps {\n    curve: CatmullRomCurve3;\n    messages: MessageArrived[] | undefined;\n    duration: number;\n    elapsed: number;\n    prefix: string;\n}\n\nexport const EdgeMessages: FC<EdgeMessagesProps> = ({ prefix, curve, elapsed, messages, duration }) => {\n    const messageMeshes = useMemo(() => {\n        return (messages || []).map(message => {\n            return {\n                key: message.messageKey,\n                position: curve.getPointAt(Math.max(0, Math.min(1, (elapsed - message.frame) / duration))),\n                color: message.messageKey[0] === \"1\" ? \"#4070f0\" : message.messageKey[0] === \"2\" ? \"#f07040\" : \"#70f040\"\n            };\n        });\n    }, [elapsed, messages, curve, duration]);\n\n    return (\n        <>\n            {messageMeshes.map((messageMesh, i) => {\n                return (\n                    <mesh key={prefix + i} position={messageMesh.position}>\n                        <sphereGeometry attach=\"geometry\" args={[0.076]} />\n                        <meshPhongMaterial attach=\"material\" color={messageMesh.color} />\n                    </mesh>\n                );\n            })}\n        </>\n    );\n};\n","import { keyBy } from \"lodash\";\nimport React, { FC, useCallback, useEffect, useMemo, useState } from \"react\";\nimport { useFrame, useThree } from \"react-three-fiber\";\nimport { CatmullRomCurve3, Vector3 } from \"three\";\nimport { MessageArrived, EdgeMessages } from \"./messages\";\nimport { NodeProps, NodeType } from \"./node\";\n\nexport function usePath(points: Vector3[]) {\n    return useMemo(() => {\n        return new CatmullRomCurve3(points, false, \"catmullrom\");\n    }, [points]);\n}\n\nfunction useTrackMessages(\n    messagePump: MessageArrived[] | undefined,\n    duration: number,\n    elapsedTime: number,\n    onEgress: (messages: MessageArrived[]) => void\n) {\n    const [messages, setMessages] = useState<MessageArrived[] | undefined>(undefined);\n    useEffect(() => {\n        if (!messagePump || messagePump.length === 0) return;\n        // console.log(\"New messages: \" + JSON.stringify(messagePump));\n        setMessages(msg => [...(msg || []), ...messagePump]);\n    }, [messagePump, duration]);\n    const unexpiredMessages = useMemo<MessageArrived[]>(() => {\n        if (!messages || messages.length === 0) return [];\n        const m = messages[0];\n        if (elapsedTime >= m.frame + duration) {\n            return messages.filter(m => elapsedTime < m.frame + duration);\n        } else {\n            return messages;\n        }\n    }, [messages, duration, elapsedTime]);\n\n    const expiredMessages = useMemo(() => {\n        const emptyArray: MessageArrived[] = [];\n        if (!messages || messages.length === 0) {\n            return emptyArray;\n        }\n        const m = messages[0];\n        if (elapsedTime >= m.frame + duration) {\n            // console.log(\"Filtering \");\n            return messages.filter(m => elapsedTime >= m.frame + duration);\n        } else return emptyArray;\n    }, [messages, duration, elapsedTime]);\n\n    useEffect(() => {\n        if (!expiredMessages || expiredMessages.length === 0) return;\n        const keyed = keyBy(expiredMessages, m => m.messageKey);\n        setMessages(msg => (msg || []).filter(m => !keyed[m.messageKey]));\n    }, [expiredMessages]);\n\n    useEffect(() => {\n        // console.log({ elapsedTime });\n        if (!expiredMessages || expiredMessages.length === 0) return;\n        // console.log(\"Time to delete: \" + expiredMessages.length + \" \" + messages?.length);\n        onEgress(expiredMessages);\n    }, [duration, expiredMessages, onEgress]);\n    return unexpiredMessages;\n}\n\nexport interface EdgeProps extends Pick<NodeProps, \"onEgress\"> {\n    points: Vector3[];\n    duration: number;\n    fromNode: string;\n    toNode: string;\n    elapsed: number;\n    messages?: MessageArrived[];\n}\n\nexport const Edge: FC<EdgeProps> = ({ fromNode, toNode, messages, points, duration, elapsed, onEgress }) => {\n    const _onEgress = useCallback((messages: MessageArrived[]) => onEgress(fromNode, toNode, messages), [\n        fromNode,\n        toNode,\n        onEgress\n    ]);\n    const [elapsedMs, setElapsedMs] = useState(0);\n    useFrame(({ clock }) => {\n        setElapsedMs(clock.elapsedTime);\n    });\n\n    const messagesBuffered = useTrackMessages(messages, duration, elapsed, _onEgress);\n    const curve = usePath(points);\n    return (\n        <>\n            <mesh key={`${fromNode}-${toNode}-edge`}>\n                <tubeGeometry attach=\"geometry\" args={[curve, 80, 0.03, 8, false]} />\n                <meshPhongMaterial attach=\"material\" color=\"#333\" />\n            </mesh>\n            <EdgeMessages\n                key={`${fromNode}-${toNode}-messages`}\n                elapsed={elapsedMs}\n                prefix={`${fromNode}-${toNode}-messages`}\n                curve={curve}\n                duration={duration}\n                messages={messagesBuffered}\n            />\n        </>\n    );\n};\n","import React, { forwardRef, useCallback, useMemo } from \"react\";\nimport { ExtrudeBufferGeometry, ExtrudeGeometryOptions, LineCurve3, Mesh, Shape, Vector2, Vector3 } from \"three\";\n\n// export type MeshNode = ReactThreeFiber.Object3DNode<Mesh, typeof Mesh>;\n\nexport interface TextProps {\n    width: number;\n    height: number;\n    text: string;\n    depth: number;\n    backgroundColor?: string;\n    color?: string;\n    position: Vector3;\n    onClick: (args: { text: string }) => void;\n}\n\nconst stepFunction = (v: number, neg = false) => (neg ? 1 - (v / Math.abs(v) + 1) / 2 : (v / Math.abs(v) + 1) / 2);\n\nconst generateTopUV = (\n    geometry: ExtrudeBufferGeometry,\n    vertices: number[],\n    indexA: number,\n    indexB: number,\n    indexC: number\n) => {\n    const rear = vertices[indexA * 3 + 2] < 0;\n    var a_x = stepFunction(vertices[indexA * 3], rear);\n    var a_y = stepFunction(vertices[indexA * 3 + 1], false);\n    var b_x = stepFunction(vertices[indexB * 3], rear);\n    var b_y = stepFunction(vertices[indexB * 3 + 1], false);\n    var c_x = stepFunction(vertices[indexC * 3], rear);\n    var c_y = stepFunction(vertices[indexC * 3 + 1], false);\n    return [new Vector2(a_x, a_y), new Vector2(b_x, b_y), new Vector2(c_x, c_y)];\n};\n\nconst generateSideWallUV = (\n    geometry: ExtrudeBufferGeometry,\n    vertices: number[],\n    indexA: number,\n    indexB: number,\n    indexC: number,\n    indexD: number\n) => {\n    const depth = (geometry as any)[\"parameters\"].options.depth;\n    const curves = (geometry as any)[\"parameters\"].shapes.curves as LineCurve3[];\n    const mX = curves.reduce(\n        (p, c) => [Math.min(p[0], c.v1.x, c.v2.x), Math.max(p[1], c.v1.x, c.v2.x)] as [number, number],\n        [Number.MAX_SAFE_INTEGER, Number.MIN_SAFE_INTEGER] as [number, number]\n    );\n    const mY = curves.reduce(\n        (p, c) => [Math.min(p[0], c.v1.y, c.v2.y), Math.max(p[1], c.v1.y, c.v2.y)] as [number, number],\n        [Number.MAX_SAFE_INTEGER, Number.MIN_SAFE_INTEGER] as [number, number]\n    );\n    const mZ = [0, depth] as [number, number];\n    const ofMax = (v: number, max: [number, number]) => (v - max[0]) / (max[1] - max[0]);\n    var a_x = ofMax(vertices[indexA * 3], mX);\n    var a_y = ofMax(vertices[indexA * 3 + 1], mY);\n    var a_z = ofMax(vertices[indexA * 3 + 2], mZ);\n    var b_x = ofMax(vertices[indexB * 3], mX);\n    var b_y = ofMax(vertices[indexB * 3 + 1], mY);\n    var b_z = ofMax(vertices[indexB * 3 + 2], mZ);\n    var c_x = ofMax(vertices[indexC * 3], mX);\n    var c_y = ofMax(vertices[indexC * 3 + 1], mY);\n    var c_z = ofMax(vertices[indexC * 3 + 2], mZ);\n    var d_x = ofMax(vertices[indexD * 3], mX);\n    var d_y = ofMax(vertices[indexD * 3 + 1], mY);\n    var d_z = ofMax(vertices[indexD * 3 + 2], mZ);\n\n    // if it's left or right side then x will not vary\n    if (Math.abs(a_x - b_x) < 0.01) {\n        const right = (x: number) => (a_x > 0.5 ? 1 - x : x);\n        return [\n            new Vector2(right(a_z), a_y),\n            new Vector2(right(b_z), b_y),\n            new Vector2(right(c_z), c_y),\n            new Vector2(right(d_z), d_y)\n        ];\n    } else {\n        return [new Vector2(0, 0), new Vector2(0, 0), new Vector2(0, 0), new Vector2(0, 0)];\n    }\n};\n\nexport const Text = forwardRef<Mesh, TextProps>(\n    ({ width, height, text, backgroundColor, color, depth, onClick, position, ...props }: TextProps, ref) => {\n        const _width = width;\n        const _height = height;\n        const _text = text;\n\n        const shape = useMemo(() => {\n            const __shape = new Shape();\n            __shape.moveTo((_width / 2) * -1, (_height / 2) * -1);\n            __shape.lineTo(_width / 2, (_height / 2) * -1);\n            __shape.lineTo(_width / 2, _height / 2);\n            __shape.lineTo((_width / 2) * -1, _height / 2);\n            __shape.lineTo((_width / 2) * -1, (_height / 2) * -1);\n            return __shape;\n        }, [_width, _height]);\n\n        const extrudeSettings = useMemo<ExtrudeGeometryOptions>(\n            () => ({\n                steps: 2,\n                depth: depth,\n                bevelEnabled: true,\n                bevelThickness: 0.03,\n                bevelSize: 0.02,\n                bevelOffset: 0.0,\n                bevelSegments: 5,\n                UVGenerator: { generateTopUV, generateSideWallUV }\n            }),\n            [depth]\n        );\n\n        const textCanvas = useMemo(() => {\n            const canvas = document.createElement(\"canvas\");\n            const context = canvas.getContext(\"2d\");\n            if (!context) return null;\n            const textureWidth = _width * 20;\n            const textureHeight = _height * 20;\n            canvas.style.position = \"absolute\";\n            canvas.style.top = `calc(50% - ${textureHeight / 2}px)`;\n            canvas.style.width = textureWidth + \"px\";\n            canvas.style.height = textureHeight + \"px\";\n            canvas.width = textureWidth * 20;\n            canvas.height = textureHeight * 20;\n            context.scale(20, 20);\n            context.fillStyle = backgroundColor || \"grey\";\n\n            context.fillRect(0, 0, textureWidth, textureHeight);\n            const fontSize = textureHeight / 1.8;\n            context.font = `bold ${fontSize}px Arial, sans-serif`;\n            context.fillStyle = color || \"white\";\n            context.textAlign = \"center\";\n            context.textBaseline = \"middle\";\n            const x = textureWidth / 2;\n            const y = textureHeight / 2;\n            context.fillText(_text, x, y);\n            return canvas;\n        }, [_width, _height, color, backgroundColor, _text]);\n        const _onClick = useCallback(() => {\n            onClick({ text });\n        }, [text, onClick]);\n        return (\n            <mesh ref={ref} onClick={_onClick} position={position} {...props}>\n                <boxBufferGeometry args={[_width, _height, depth]} attach=\"geometry\" />\n                <extrudeGeometry attach=\"geometry\" args={[shape, extrudeSettings]} />\n                <meshStandardMaterial roughness={0.2} metalness={0.8} attachArray=\"material\">\n                    <canvasTexture attach=\"map\" image={textCanvas} />\n                </meshStandardMaterial>\n                <meshStandardMaterial roughness={0.2} metalness={0.8} attachArray=\"material\">\n                    <canvasTexture attach=\"map\" image={textCanvas} />\n                </meshStandardMaterial>\n            </mesh>\n        );\n    }\n);\n\nText.defaultProps = { depth: 0.04, width: 1, height: 0.3, text: \"<null>\" };\n","import React, { FC, useCallback, useMemo, useState, useRef, RefObject } from \"react\";\nimport { Vector3, Mesh } from \"three\";\nimport { Edge, EdgeProps } from \"./edge\";\nimport { MessageProps, MessageArrived } from \"./messages\";\nimport { Text } from \"../three-utils/text\";\nimport { useFrame } from \"react-three-fiber\";\n\nexport type NodeEdgeType = Pick<EdgeProps, \"duration\" | \"messages\" | \"points\" | \"toNode\">;\nexport type NodeType = Pick<NodeProps, \"name\">;\nexport type MessageType = Pick<MessageProps, \"messageKey\">;\n\nexport interface NodeEdge {\n    to: string;\n    points: Vector3;\n}\n\nexport interface NodeProps {\n    position: Vector3;\n    type: string;\n    width: number;\n    height: number;\n    depth: number;\n    name: string;\n    edges: NodeEdgeType[];\n    messages: MessageArrived[] | undefined;\n    onEgress: (fromNode: string, toNode: string, messages: MessageArrived[]) => void;\n    onSelect: (args: { name: string; mesh: Mesh }) => void;\n}\n\nexport function useCheckMessages(messages: MessageType[] | undefined) {\n    const [elapsedTime, setElpased] = useState(0);\n    useFrame(({ clock }) => {\n        setElpased(Math.floor(clock.elapsedTime * 100) / 100);\n    });\n    return elapsedTime;\n}\ninterface LabelProps {\n    name: string;\n    width: number;\n    depth: number;\n    height: number;\n    position: Vector3;\n    onSelect: (args: { name: string; mesh: Mesh }) => void;\n}\n\nexport const Label: FC<LabelProps> = ({ name, position, width, height, depth, onSelect }) => {\n    const ref = useRef<Mesh>() as RefObject<Mesh>;\n    const _onSelect = useCallback(\n        ({ text }: { text: string }) => ref.current && onSelect({ name: text, mesh: ref.current }),\n        [onSelect]\n    );\n    const pos = useMemo(() => new Vector3(position.x, position.y, position.z - depth / 2), [position, depth]);\n    return (\n        <Text\n            key={name}\n            ref={ref}\n            onClick={_onSelect}\n            text={name}\n            color={\"#202020\"}\n            width={width}\n            height={height * 0.25}\n            backgroundColor=\"#a0a0ff\"\n            depth={depth}\n            position={pos}\n        />\n    );\n};\n\nexport const Edges: FC<{ edges: EdgeProps[] }> = ({ edges }) => (\n    <>\n        {edges.map(edge => (\n            <Edge key={`${edge.fromNode}-${edge.toNode}-edge`} {...edge} />\n        ))}\n    </>\n);\n\nexport const Node: FC<NodeProps> = ({ name, onSelect, width, height, depth, position, messages, edges, onEgress }) => {\n    const elapsed = useCheckMessages(messages);\n    const edgeProps = useEdges(edges, name, messages, elapsed, onEgress);\n    return (\n        <>\n            <Label\n                key=\"label\"\n                name={name}\n                onSelect={onSelect}\n                width={width}\n                height={height}\n                depth={Math.abs(depth)}\n                position={position}\n            />\n            <Edges edges={edgeProps} />\n        </>\n    );\n};\n\nexport function useEdges(\n    edges: NodeEdgeType[],\n    name: string,\n    messages: MessageArrived[] | undefined,\n    elapsed: number,\n    onEgress: (fromNode: string, toNode: string, messages: MessageArrived[]) => void\n) {\n    return useMemo<EdgeProps[]>(\n        () =>\n            edges.map(edge => ({\n                ...edge,\n                duration: edge.duration, //+ Math.floor(Math.random() * 4),\n                fromNode: name,\n                messages,\n                elapsed,\n                onEgress\n            })),\n        [edges, name, elapsed, messages, onEgress]\n    );\n}\n","import { useCallback, useState } from \"react\";\nimport { useFrame } from \"react-three-fiber\";\nimport { Vector3 } from \"three\";\n\ninterface UseVelConfig {\n    damper?: number;\n    spring?: number;\n}\n\nexport function useVel(initial: Vector3, target: Vector3, { damper = 0.72, spring = 0.003 }: UseVelConfig) {\n    const [state, set] = useState({ pos: { x: initial.x, y: initial.y, z: initial.z }, vel: { x: 0, y: 0, z: 0 } });\n    const onFrame = useCallback(() => {\n        set(state => ({\n            vel: {\n                x: ((target.x - state.pos.x) * spring + state.vel.x) * damper,\n                y: ((target.y - state.pos.y) * spring + state.vel.y) * damper,\n                z: ((target.z - state.pos.z) * spring + state.vel.z) * damper\n            },\n            pos: {\n                x: state.pos.x + state.vel.x,\n                y: state.pos.y + state.vel.y,\n                z: state.pos.z + state.vel.z\n            }\n        }));\n    }, [target.x, target.y, target.z, damper, spring]);\n    useFrame(onFrame);\n    return new Vector3(state.pos.x, state.pos.y, state.pos.z);\n}\n","import React, { FC, useCallback, useState, useRef } from \"react\";\nimport { useFrame, useThree, extend } from \"react-three-fiber\";\nimport { Vector3, PerspectiveCamera } from \"three\";\nimport { useVel } from \"./use-spring-3d\";\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\n\nextend({ OrbitControls });\n\nfunction Controls({ target }: { target?: Vector3 }) {\n    const controls = useRef<OrbitControls>();\n    const { gl, camera } = useThree();\n    useFrame(() => controls && controls.current && controls.current.update());\n    return (\n        <orbitControls\n            ref={controls}\n            args={[camera, gl.domElement]}\n            enableDamping\n            target={target}\n            dampingFactor={0.1}\n            rotateSpeed={0.5}\n        />\n    );\n}\n\ninterface UseCameraRigOptions {\n    distance: number;\n    rotate?: number;\n    orbit?: boolean;\n}\n\nexport function useCameraPan(targetPosition: Vector3, { distance, rotate, orbit }: UseCameraRigOptions) {\n    const { clock, camera } = useThree();\n    const t = clock.getElapsedTime() * (((rotate || 360) / 56000) * (2 * Math.PI)) + Math.PI / 2;\n    const x = distance * Math.cos(t) + targetPosition.x;\n    const z = distance * Math.sin(t) + targetPosition.z;\n    const camPosS = new Vector3(x, targetPosition.y, z);\n    const camPos = useVel(new Vector3(0, 0, 10), camPosS, { spring: 0.006, damper: 0.9 });\n    const camLookAt = useVel(new Vector3(0, 0, 0), targetPosition, {\n        spring: 0.01,\n        damper: 0.85\n    });\n    if (!orbit) {\n        camera.lookAt(camLookAt);\n        camera.position.set(camPos.x, camPos.y, camPos.z);\n    } else {\n        return camLookAt;\n    }\n    return camPos;\n}\n\nexport function useSelectedNode(points: any[]) {\n    const [index, setIndex] = useState(0);\n    const cb = useCallback(\n        ({ clock }: any) => {\n            const time = clock.getElapsedTime() / 2;\n            const index = Math.floor(time) % points.length;\n            setIndex(index);\n        },\n        [points]\n    );\n    useFrame(cb);\n    return index;\n}\n\ninterface CameraRigggProps {\n    targetPosition: Vector3;\n    distance: number;\n    orbit?: boolean;\n}\n\nexport const CameraRig: FC<CameraRigggProps> = ({ targetPosition, distance, orbit }) => {\n    const pos = useCameraPan(targetPosition, { distance, orbit });\n    return (\n        <>\n            <perspectiveCamera attach=\"camera\" {...(!orbit && { position: pos })} args={[45, 2, 1, 100]} />\n            {orbit && <Controls target={pos} />}\n        </>\n    );\n};\n","import { useMemo } from \"react\";\nimport { useThree } from \"react-three-fiber\";\nimport { Vector3 } from \"three\";\n\nexport interface PositionedNode {\n    name: string;\n    width: number;\n    height: number;\n    type: string;\n    depth: number;\n    position: Vector3;\n}\n\nexport interface PositionedEdge {\n    name?: string;\n    messages?: number;\n    from: string;\n    to: string;\n    points: Vector3[];\n}\n\nexport type MinMax = [number, number];\n\nexport interface Layout {\n    nodes: PositionedNode[];\n    edges: PositionedEdge[];\n    width: MinMax;\n    height: MinMax;\n    depth: MinMax;\n}\n\n// export function usePath(edges: PositionedEdge[]) {\n//     const paths = useMemo(() => {\n//         const edgeCurves = edges.map(edge => ({\n//             edge,\n//             curve: new CatmullRomCurve3(edge.points, false, \"catmullrom\")\n//         }));\n//         return groupBy(edgeCurves, e => `${e.edge.from}**${e.edge.to}`);\n//     }, [edges]);\n//     return paths;\n// }\nconst viewPortDepth = -15;\n\n// function scaleToFit(p: number, sourceMin: number, targetRange: number, scaleFactor: number) {\n//     return (p - sourceMin) * scaleFactor + targetRange / -0.5;\n// }\n\nfunction scaleToFit3(p: Vector3, midGraph: Vector3, depth: number, scaleFactor: number) {\n    return new Vector3(\n        (p.x - midGraph.x) * scaleFactor, //- targetRange.x / 2,\n        (p.y - midGraph.y) * scaleFactor, //- targetRange.y / 2,\n        (p.z - midGraph.z) * scaleFactor - (depth * scaleFactor) / 2 //- targetRange.z\n        // scaleToFit(p.x, minGraph.x, targetRange.x, scaleFactor),\n        // scaleToFit(p.y, minGraph.y, targetRange.y, scaleFactor),\n        // scaleToFit(p.z, minGraph.z, targetRange.z, scaleFactor)\n    );\n}\n\nexport function scalePoint(\n    p: Vector3,\n    graph: Layout,\n    viewportWidth: number,\n    viewportHeight: number,\n    scaleFactor: number\n) {\n    // const targetRange = new Vector3(\n    //     viewportWidth * scaleFactor,\n    //     viewportHeight * scaleFactor,\n    //     viewPortDepth * scaleFactor\n    // );\n    const midGraph = new Vector3(\n        (graph.width[1] + graph.width[0]) / 2,\n        (graph.height[1] + graph.height[0]) / 2,\n        (graph.depth[1] + graph.depth[0]) / 2\n    );\n    return scaleToFit3(p, midGraph, graph.depth[1] - graph.depth[0], scaleFactor);\n}\n\nexport function useScaleFactor(graph: Layout) {\n    const { viewport } = useThree();\n    const width = graph.width[1] - graph.width[0];\n    const height = graph.height[1] - graph.height[0];\n    const depth = graph.depth[1] - graph.depth[0];\n    return useMemo(() => {\n        const maxGraph = Math.max(width, height, depth);\n        const minScreen = Math.min(viewport.height, viewport.width);\n        return minScreen / maxGraph;\n    }, [width, height, depth, viewport.height, viewport.width]);\n}\n\nexport function useGraphViewPort(graph: Layout): Layout {\n    // const { viewport } = useThree();\n    const scaleFactor = useScaleFactor(graph);\n    // const viewPortRange = new Vector3(\n    //     viewport.width, //* scaleFactor,\n    //     viewport.height, //* scaleFactor,\n    //     viewPortDepth //* scaleFactor\n    // );\n    const midGraph = new Vector3(\n        (graph.width[1] + graph.width[0]) / 2,\n        (graph.height[1] + graph.height[0]) / 2,\n        (graph.depth[1] + graph.depth[0]) / 2\n    );\n    return useMemo<Layout>(() => {\n        const nodes = graph.nodes.map<PositionedNode>(node => ({\n            name: node.name,\n            type: node.type,\n            position: scaleToFit3(node.position, midGraph, graph.depth[1] - graph.depth[0], scaleFactor),\n            width: node.width * scaleFactor, //, graph.width, viewport.width),\n            height: node.height * scaleFactor, //, graph.height, viewport.height),\n            depth: node.depth * scaleFactor //, graph.depth, viewPortDepth)\n        }));\n        const edges = graph.edges.map<PositionedEdge>(({ points, from, to }) => ({\n            from: from,\n            to: to,\n            points: points.map(p => scaleToFit3(p, midGraph, graph.depth[1] - graph.depth[0], scaleFactor))\n        }));\n        const width = (graph.width[1] - graph.width[0]) * scaleFactor; //, graph.width, viewport.width);\n        const height = (graph.height[1] - graph.height[0]) * scaleFactor; //, graph.height, viewport.height);\n        return {\n            width: [width * -0.5, width * 0.5],\n            height: [height * 0.5, height * 0.5],\n            nodes,\n            edges,\n            depth: [viewPortDepth, -1]\n        };\n    }, [scaleFactor, midGraph, graph]);\n}\n","import React, { FC, useRef, useState, useEffect } from \"react\";\nimport { useFrame } from \"react-three-fiber\";\nimport { DoubleSide, Color, MeshBasicMaterial, ShapePath, Vector3, BackSide } from \"three\";\nimport { SVGLoader, SVGResult, StrokeStyle } from \"three/examples/jsm/loaders/SVGLoader\";\n// import { GridHelper} from \"three/examples/jsm/helpers/PositionalAudioHelper\"\n\ninterface ThisStyle extends StrokeStyle {\n    fill: string;\n    fillOpacity: number;\n    strokeOpacity: number;\n    stroke?: string;\n}\n\ninterface ShapePath2 extends ShapePath {\n    userData: {\n        style: ThisStyle;\n    };\n}\n\ninterface SvgMeshPathProps {\n    path: ShapePath2;\n    options: Omit<SvgMeshProps, \"url\" | \"scale\" | \"position\">;\n}\n\nconst SvgMeshPath: FC<SvgMeshPathProps> = ({\n    options: { drawFillShapes, fillShapesWireframe, drawStrokes, strokesWireframe },\n    path\n}) => {\n    const fillMat = useRef<MeshBasicMaterial>();\n    const strokeMat = useRef<MeshBasicMaterial>();\n    const userData = path.userData;\n\n    return (\n        <>\n            {drawFillShapes && userData.style.fill !== undefined && userData.style.fill !== \"none\" && (\n                <meshPhongMaterial\n                    ref={fillMat}\n                    color={new Color().setStyle(userData.style.fill)}\n                    opacity={userData.style.fillOpacity}\n                    transparent={userData.style.fillOpacity?.toString() === \"0\"}\n                    side={DoubleSide}\n                    depthWrite={false}\n                    wireframe={fillShapesWireframe}\n                />\n            )}\n            {path.toShapes(false).map((shape, i) => (\n                <mesh key={\"shape-\" + i}>\n                    <shapeBufferGeometry attach=\"geometry\" args={[shape]} />\n                </mesh>\n            ))}\n            {drawStrokes && userData.style.stroke !== undefined && userData.style.stroke !== \"none\" && (\n                <meshPhongMaterial\n                    ref={strokeMat}\n                    color={new Color().setStyle(userData.style.stroke)}\n                    opacity={userData.style.strokeOpacity}\n                    transparent={userData.style.strokeOpacity < 1}\n                    side={DoubleSide}\n                    depthWrite={false}\n                    wireframe={strokesWireframe}\n                />\n            )}\n            {path.subPaths?.map((subPath, i) => {\n                const geometry = SVGLoader.pointsToStroke(subPath?.getPoints(), userData.style, 8, 5);\n                return (\n                    (geometry && strokeMat.current && (\n                        <mesh key={\"stroke-\" + i} geometry={geometry} material={strokeMat.current} />\n                    )) ||\n                    null\n                );\n            })}\n        </>\n    );\n};\n\ninterface SvgMeshProps {\n    url: string;\n    position: Vector3;\n    scale: number;\n    drawStrokes: boolean;\n    strokesWireframe: boolean;\n    drawFillShapes: boolean;\n    fillShapesWireframe: boolean;\n}\n\nconst SvgMesh: FC<SvgMeshProps> = ({\n    url,\n    position,\n    scale,\n    drawStrokes,\n    drawFillShapes,\n    fillShapesWireframe,\n    strokesWireframe\n}) => {\n    const [svgData, setSvgData] = useState<SVGResult | null>(null);\n    useEffect(() => {\n        const loader = new SVGLoader();\n        loader.load(url, result => {\n            setSvgData(result);\n        });\n    }, [url, setSvgData]);\n    return (\n        <group scale={[(1 / 500) * scale, (1 / 500) * scale, 1]} position={position.setX(position.x - 0.5 * scale)}>\n            {svgData &&\n                svgData.paths.map(\n                    path =>\n                        path && (\n                            <SvgMeshPath\n                                path={path as ShapePath2}\n                                options={{ drawFillShapes, drawStrokes, strokesWireframe, fillShapesWireframe }}\n                            />\n                        )\n                )}\n        </group>\n    );\n};\n\nSvgMesh.defaultProps = {\n    drawFillShapes: true,\n    drawStrokes: true,\n    fillShapesWireframe: false,\n    strokesWireframe: false\n};\n\nexport { SvgMesh };\n","import React, { FC } from \"react\";\nimport { Edges, Label, NodeProps, useCheckMessages, useEdges } from \"./node\";\n\nimport { SvgMesh } from \"../three-utils/svg-mesh\";\nimport logo from \"../kafka.svg\";\nimport { Vector3 } from \"three\";\n\nexport const BrokerQueueNode: FC<NodeProps> = ({\n    name,\n    onSelect,\n    width,\n    height,\n    depth,\n    position,\n    messages,\n    edges,\n    onEgress\n}) => {\n    const elapsed = useCheckMessages(messages);\n    const edgeProps = useEdges(edges, name, messages, elapsed, onEgress);\n    return (\n        <>\n            <SvgMesh\n                strokesWireframe={false}\n                fillShapesWireframe={false}\n                drawFillShapes\n                drawStrokes\n                url={logo}\n                scale={width}\n                position={new Vector3(position.x, position.y + height / 3, position.z)}\n            />\n            <Label\n                key=\"label\"\n                name={name}\n                onSelect={onSelect}\n                width={width}\n                height={height}\n                depth={depth}\n                position={position}\n            />\n            <Edges edges={edgeProps} />\n        </>\n    );\n};\n","import { groupBy } from \"lodash\";\nimport React, { FC, useCallback, useEffect, useMemo, useState } from \"react\";\nimport { useThree } from \"react-three-fiber\";\nimport { Vector3, Mesh } from \"three\";\nimport { MessageArrived, MessageProps } from \"../component/messages\";\nimport { Node, NodeEdgeType, NodeProps } from \"../component/node\";\nimport { CameraRig } from \"../three-utils/camera-rig\";\nimport { Layout, scalePoint, useGraphViewPort, useScaleFactor } from \"./use-graph-viewport\";\nimport { BrokerQueueNode } from \"../component/broker-queue\";\n\ninterface GraphProps {\n    graph: Layout;\n    feed: { to: string | null; messages: MessageProps[] }[];\n    onSelectNode: (args: { name: string; mesh: Mesh }) => void;\n    selectedNode?: string | null;\n    orbit: boolean;\n}\n\ntype FeedType = { [nodeName: string]: { count: number; messages: MessageArrived[] | undefined } | undefined };\nexport const Graph: FC<GraphProps> = ({ graph, onSelectNode, selectedNode, feed, orbit }) => {\n    const { clock, viewport } = useThree();\n    const [messageState, setMessageState] = useState<FeedType>({});\n    // const [selectedMesh, setSelectedMesh] = useState<Mesh | null>(null);\n    const scaleFactor = useScaleFactor(graph);\n    useEffect(\n        () =>\n            setMessageState((state: FeedType) =>\n                feed\n                    .filter(f => !!f.to)\n                    .reduce<FeedType>(\n                        (p, c) => ({\n                            ...p,\n                            [c.to!]: {\n                                messages: c.messages.map(\n                                    (message, i) =>\n                                        ({\n                                            ...message,\n                                            messageKey: `${message.messageKey}${i +\n                                                ((state[c.to!] && state[c.to!]?.count) || 0)}) `,\n                                            frame: clock.getElapsedTime() + (i / c.messages.length) * 5\n                                        } as MessageArrived)\n                                ),\n                                count: (state[c.to!]?.count || 0) + c.messages.length\n                            }\n                        }),\n                        state\n                    )\n            ),\n        [feed, setMessageState, clock]\n    );\n    const scaledGraph = useGraphViewPort(graph);\n\n    const onSelect = useCallback(\n        (args: { name: string; mesh: Mesh }) => {\n            onSelectNode(args);\n            // setSelectedMesh(args.mesh);\n        },\n        [onSelectNode]\n    );\n    const onEgress = useCallback(\n        (fromNode: string, toNode: string, messages: MessageArrived[]) => {\n            setMessageState((state: FeedType) => ({\n                ...state,\n                [fromNode]: { ...(state[fromNode] || { count: 0 }), messages: undefined },\n                [toNode]: {\n                    ...(state[toNode] || { count: 0 }),\n                    messages: messages.map(m => ({ ...m, frame: clock.getElapsedTime() }))\n                }\n            }));\n        },\n        [clock]\n    );\n    const edgesPerNode = useMemo(() => groupBy(scaledGraph.edges, e => e.from), [scaledGraph]);\n    const nodes = useMemo(() => {\n        return scaledGraph.nodes.map<NodeProps>(node => {\n            const edges = (edgesPerNode[node.name] || []).map<NodeEdgeType>(edge => ({\n                points: edge.points,\n                duration: 5,\n                fromNode: edge.from,\n                toNode: edge.to,\n                onEgress\n            }));\n            return {\n                position: node.position,\n                name: node.name,\n                type: node.type,\n                onEgress,\n                width: node.width,\n                height: node.height,\n                depth: node.depth,\n                onSelect: onSelect,\n                messages: (messageState[node.name] && messageState[node.name]?.messages) || undefined,\n                edges\n            };\n        });\n    }, [scaledGraph, onSelect, messageState, onEgress, edgesPerNode]);\n\n    const selectedNodeIndex = useMemo(() => {\n        const index = scaledGraph.nodes.findIndex(f => f.name === selectedNode);\n        if (index >= 0) return index;\n        return null;\n    }, [selectedNode, scaledGraph]);\n    return (\n        <>\n            <CameraRig\n                orbit={orbit}\n                targetPosition={\n                    selectedNodeIndex === null\n                        ? scalePoint(\n                              new Vector3(\n                                  (graph.width[0] + graph.width[1]) / 2,\n                                  (graph.height[0] + graph.height[1]) / 2,\n                                  (graph.depth[0] + graph.depth[1]) / 2\n                              ),\n                              graph,\n                              viewport.width,\n                              viewport.height,\n                              scaleFactor\n                          )\n                        : new Vector3(\n                              nodes[selectedNodeIndex].position.x,\n                              nodes[selectedNodeIndex].position.y,\n                              nodes[selectedNodeIndex].position.z\n                          )\n                }\n                distance={selectedNode === null ? 8 : 4.5}\n            />\n            {nodes.map((node, i) =>\n                node.type === \"broker\" ? (\n                    <BrokerQueueNode key={node.name} {...node} />\n                ) : (\n                    <Node key={node.name} {...node} />\n                )\n            )}\n        </>\n    );\n};\n","import React, { useCallback, useMemo, useState, useRef, useEffect } from \"react\";\nimport { Canvas } from \"react-three-fiber\";\nimport { Graph } from \"./graph/graph\";\nimport { useNgraph } from \"./graph/nlayout-graph\";\nimport { SimNode, SimEdge } from \"./graph/sim-model\";\nimport { DirectionalLight, Vector3, DirectionalLightHelper, Mesh } from \"three\";\n// import { MeshNode } from \"./three-utils/text\";\n\ninterface DemoGraphProps {\n    nodes: SimNode[];\n    edges: SimEdge[];\n    pumpProducer: string | null;\n    pumpValue: string[] | null;\n    orbit: boolean;\n}\n\nexport const DemoGraph = ({ pumpProducer, pumpValue, nodes, edges, orbit }: DemoGraphProps) => {\n    const [selectedNode, setNode] = useState<string | null>(null);\n    const [selectedMesh, setMesh] = useState<Mesh | null>(null);\n    const graph = useNgraph(nodes, edges);\n    const onSelectNode = useCallback(\n        ({ name, mesh }: { name: string; mesh: Mesh | null }) => {\n            setNode(name);\n            setMesh(mesh);\n        },\n        [setNode, setMesh]\n    );\n    // const graph = useDag(nodes, edges, \"RL\");\n    const messages = useMemo(() => (pumpValue && pumpProducer && pumpValue.map((v, i) => ({ messageKey: v }))) || [], [\n        pumpValue,\n        pumpProducer\n    ]);\n    const light1 = useRef<DirectionalLight>();\n    const light2 = useRef<DirectionalLight>();\n    const light3 = useRef<DirectionalLight>();\n    const light4 = useRef<DirectionalLight>();\n    const lightHelper1 = useRef<DirectionalLightHelper>();\n    const lightHelper2 = useRef<DirectionalLightHelper>();\n    const lightHelper3 = useRef<DirectionalLightHelper>();\n    const lightHelper4 = useRef<DirectionalLightHelper>();\n\n    useEffect(() => {\n        if (!selectedMesh) {\n            light1.current?.lookAt(new Vector3(0, 0, 0));\n            light2.current?.lookAt(new Vector3(0, 0, 0));\n            light3.current?.lookAt(new Vector3(0, 0, 0));\n            light4.current?.lookAt(new Vector3(0, 0, 0));\n        }\n        if (lightHelper1.current) lightHelper1.current.update();\n        if (lightHelper2.current) lightHelper2.current.update();\n        if (lightHelper3.current) lightHelper3.current.update();\n        if (lightHelper4.current) lightHelper4.current.update();\n        // light1.current?.updateMatrix();\n    }, [selectedMesh, lightHelper1, lightHelper2, lightHelper3, lightHelper4]);\n    const unselect = useCallback(p => setNode(null), [setNode]);\n    return (\n        <Canvas pixelRatio={window.devicePixelRatio} onClickCapture={unselect}>\n            <ambientLight args={[0x0ffffff, 1.9]} />\n            <>\n                <spotLight\n                    ref={light1}\n                    {...(selectedMesh && { target: selectedMesh })}\n                    intensity={1}\n                    position={[10, 3, 5]}\n                    args={[0x0ffaaaa, 0.9]}\n                />\n                <spotLight\n                    ref={light2}\n                    intensity={1}\n                    {...(selectedMesh && { target: selectedMesh })}\n                    position={[-10, 0, 5]}\n                    args={[0x0aaffaa, 0.9]}\n                />\n                <spotLight\n                    ref={light3}\n                    intensity={1}\n                    {...(selectedMesh && { target: selectedMesh })}\n                    position={[-10, 1, -15]}\n                    args={[0x0aaaaff, 0.7]}\n                />\n                <spotLight\n                    ref={light4}\n                    {...(selectedMesh && { target: selectedMesh })}\n                    position={[10, 0, -15]}\n                    args={[0x0ffaaff, 0.7]}\n                />\n            </>\n            {/* {light1.current && <directionalLightHelper ref={lightHelper1} args={[light1.current]} />}\n            {light2.current && <directionalLightHelper ref={lightHelper2} args={[light2.current]} />}\n            {light3.current && <directionalLightHelper ref={lightHelper3} args={[light3.current]} />}\n            {light4.current && <directionalLightHelper ref={lightHelper4} args={[light4.current]} />} */}\n            <Graph\n                graph={graph}\n                feed={[{ to: pumpProducer, messages }]}\n                selectedNode={selectedNode}\n                onSelectNode={onSelectNode}\n                orbit={orbit}\n            />\n        </Canvas>\n    );\n};\n","import createGraph from \"ngraph.graph\";\nimport layout3d from \"ngraph.forcelayout3d\";\nimport { useMemo } from \"react\";\nimport { PositionedNode, PositionedEdge, Layout, MinMax } from \"./use-graph-viewport\";\nimport { Vector3 } from \"three\";\nimport { SimEdge, SimNode } from \"./sim-model\";\n\nconst ITERATIONS_COUNT = 100;\n\nexport function useNgraph(nodes: SimNode[], edges: SimEdge[]): Layout {\n    const positioned = useMemo(() => {\n        var graph = createGraph<SimNode, SimEdge>();\n        for (const n of nodes) {\n            graph.addNode(n.name, n);\n        }\n        for (const e of edges) graph.addLink(e.from, e.to, e);\n        const layout = layout3d(graph, { gravity: -30 });\n        for (const n of nodes) {\n            if (n.x !== undefined || n.y !== undefined || n.z !== undefined)\n                layout.setNodePosition(n.name, -10 * (n.x || 10), n.y || Math.random() * 500, n.z || 0);\n        }\n\n        for (let i = 0; i < ITERATIONS_COUNT; ++i) {\n            layout.step();\n        }\n        const retnodes: PositionedNode[] = nodes.map(n => {\n            const { x, y, z } = layout.getNodePosition(n.name);\n            return {\n                name: n.name,\n                width: n.width,\n                height: n.height,\n                depth: n.depth,\n                position: new Vector3(x, y, z),\n                type: n.type || \"basic\"\n            };\n        });\n        const retEdges: PositionedEdge[] = edges.map(e => {\n            const fromPos = layout.getNodePosition(e.from);\n            const toPos = layout.getNodePosition(e.to);\n            const fromNode = graph.getNode(e.from)?.data!;\n            const toNode = graph.getNode(e.to)?.data!;\n\n            const mid = (from: number, to: number, delta: number) => (to - from) * delta + from;\n\n            const connectPoint = (pos: Vector3, output: boolean) => {\n                if (!output) return new Vector3(pos.x - toNode.width / 2, pos.y, pos.z);\n                else return new Vector3(pos.x + fromNode.width / 2, pos.y, pos.z);\n            };\n\n            const midp = new Vector3(\n                mid(fromPos.x, toPos.x, 0.5),\n                mid(fromPos.y, toPos.y, 0.5),\n                mid(fromPos.z, toPos.z, 0.5)\n            );\n            const fromPoint = connectPoint(new Vector3(fromPos.x, fromPos.y, fromPos.z), true);\n            const toPoint = connectPoint(new Vector3(toPos.x, toPos.y, toPos.z), false);\n            const fromHose = new Vector3(\n                fromPoint.x + fromNode.width / 2,\n                mid(fromPoint.y, toPoint.y, 0.1),\n                mid(fromPoint.z, toPoint.z, 0.1)\n            );\n            const toHose = new Vector3(\n                toPoint.x - toNode.width / 2,\n                mid(fromPoint.y, toPoint.y, 0.9),\n                mid(fromPoint.z, toPoint.z, 0.9)\n            );\n            return {\n                from: e.from,\n                to: e.to,\n                points: [fromPoint, fromHose, midp, toHose, toPoint]\n            };\n        });\n        const { x1, x2, y1, y2, z1, z2 } = layout.getGraphRect();\n        return {\n            nodes: retnodes,\n            edges: retEdges,\n            width: [x1, x2] as MinMax,\n            height: [y1, y2] as MinMax,\n            depth: [z1, z2] as MinMax\n        };\n    }, [nodes, edges]);\n    return positioned;\n}\n","import React, { useState, FC, useRef, useCallback } from \"react\";\n\ninterface RecordProps {\n    filename: string;\n}\n\ndeclare global {\n    export interface MediaDevices {\n        getDisplayMedia(x: MediaStreamConstraints): Promise<MediaStream>;\n    }\n}\n\nexport const RecordStream: FC<RecordProps> = ({ filename }) => {\n    const [downloadUrl, setDownloadUrl] = useState<string | null>(null);\n    const [recorder, setRecorder] = useState<MediaRecorder | null>(null);\n    const videoRef = useRef<HTMLVideoElement | null>(null);\n    const onsStart = useCallback(() => {\n        async function doit() {\n            const recData: Blob[] = [];\n            const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });\n            videoRef.current!.srcObject = stream;\n            const currRec = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=\"vp8,opus\"' });\n            currRec.ondataavailable = e => recData.push(e.data);\n            currRec.onstop = () => {\n                const blob = new Blob(recData, { type: recData[0].type });\n                setDownloadUrl(URL.createObjectURL(blob));\n            };\n            currRec.start();\n            setRecorder(currRec);\n            return null;\n        }\n        if (videoRef.current) doit();\n    }, [videoRef]);\n    const onStop = useCallback(() => recorder && recorder.stop(), [recorder]);\n    return (\n        <div style={{ padding: 2, backgroundColor: \"#303030\", width: 120 }}>\n            <video style={{ display: \"hidden\", width: 1, height: 1 }} ref={videoRef} />\n            {downloadUrl ? (\n                <a href={downloadUrl} download={filename + \".webm\"}>\n                    Click to Download\n                </a>\n            ) : !recorder ? (\n                <button onClick={onsStart}>Start Recording</button>\n            ) : (\n                <button onClick={onStop}>Stop Recording</button>\n            )}\n        </div>\n    );\n};\n","import React, { useState, useCallback, CSSProperties } from \"react\";\nimport \"./App.css\";\nimport { DemoGraph } from \"./demo-graph\";\nimport { RecordStream } from \"./component/record-stream\";\n\nconst height = 15;\nconst width = 20;\nconst depth = 20;\n\nconst producer1 = \"Producer #1\";\nconst producer2 = \"Producer #2\";\nconst producer3 = \"Producer #3\";\nconst messageQueue = \"Message Queue\";\nconst consumer1 = \"Consumer #1\";\nconst consumer2 = \"Consumer #2\";\nconst consumer3 = \"Consumer #3\";\nconst consumer4 = \"Consumer #4\";\nconst messageQueue2 = \"Out Queue\";\n// const client = \"Client\";\n\nconst commonNode = { width, height, depth };\nconst nodes = [\n    { name: producer1, ...commonNode, x: 100 },\n    { name: producer2, ...commonNode, x: 100 },\n    { name: producer3, ...commonNode, x: 100 },\n    { name: messageQueue, type: \"broker\", ...commonNode },\n    { name: consumer1, ...commonNode, x: -100 },\n    { name: consumer2, ...commonNode, x: -100 },\n    { name: consumer3, ...commonNode, x: -100 },\n    { name: consumer4, ...commonNode, x: -100 },\n    { name: messageQueue2, ...commonNode, y: -300 }\n];\n\nconst edges = [\n    { from: producer1, to: messageQueue, weight: 2 },\n    { from: producer2, to: messageQueue, weight: 2 },\n    { from: producer3, to: messageQueue, weight: 2 },\n    { from: messageQueue, to: consumer1, weight: 2 },\n    { from: messageQueue, to: consumer2, weight: 2 },\n    { from: messageQueue, to: consumer3, weight: 2 },\n    { from: messageQueue, to: consumer4, weight: 2 },\n    { from: consumer3, to: messageQueue2, weight: 2 }\n];\nconst buttonStyle = {\n    backgroundColor: \"black\",\n    color: \"#bbb\",\n    height: 25,\n    fontWeight: \"bold\",\n    margin: 5\n} as CSSProperties;\n\nconst App: React.FC = () => {\n    const [pump, setPump] = useState<{ id: string; v: string[] } | null>(null);\n    const [orbit, setOrbit] = useState<boolean>(false);\n    const pump1 = useCallback(() => setPump({ id: producer1, v: [\"1X\"] }), [setPump]);\n    const pump2 = useCallback(() => setPump({ id: producer2, v: [\"2X\"] }), [setPump]);\n    const pump3 = useCallback(() => setPump({ id: producer3, v: [\"3X\"] }), [setPump]);\n    const orbitChange = useCallback<React.ChangeEventHandler<HTMLInputElement>>(\n        ({ target }) => {\n            console.log(\"Checked \" + target.checked);\n            setOrbit(target.checked);\n        },\n        [setOrbit]\n    );\n\n    return (\n        <div className=\"App\">\n            <header className=\"App-header\">\n                <div>DAG 3D Component</div>\n                <button style={buttonStyle} onClick={pump1}>\n                    Pump Producer #1\n                </button>\n                <button style={buttonStyle} onClick={pump2}>\n                    Pump Producer #2\n                </button>\n                <button style={buttonStyle} onClick={pump3}>\n                    Pump Producer #3\n                </button>\n                <label className=\"switch\" style={{ margin: 3 }}>\n                    <input className=\"switch-input\" type=\"checkbox\" checked={orbit} onChange={orbitChange} />\n                    <span className=\"switch-label\" data-on=\"Pan\" data-off=\"Auto\"></span>\n                    <span className=\"switch-handle\"></span>\n                </label>\n                <div>\n                    <RecordStream filename=\"dag3d\" />\n                </div>\n            </header>\n            <DemoGraph\n                pumpProducer={(pump && pump.id) || null}\n                pumpValue={pump && pump.v}\n                nodes={nodes}\n                edges={edges}\n                orbit={orbit}\n            />\n        </div>\n    );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}