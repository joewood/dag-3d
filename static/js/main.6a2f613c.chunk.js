(this["webpackJsonpdag-3d"]=this["webpackJsonpdag-3d"]||[]).push([[0],{33:function(e,t,n){e.exports=n(66)},37:function(e,t,n){},38:function(e,t,n){},66:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(12),c=n.n(o),i=(n(37),n(3)),u=n(4),s=(n(38),n(5)),l=n(2),m=n(16),d=n(1),h=n(7),f=function(e){var t=e.prefix,n=e.curve,o=e.elapsed,c=e.messages,i=e.duration,u=Object(a.useMemo)((function(){return(c||[]).map((function(e){return{key:e.messageKey,pt:n.getPointAt(Math.max(0,Math.min(1,(o-e.frame)/i))),color:"1"===e.messageKey[0]?"#4070f0":"2"===e.messageKey[0]?"#f07040":"#70f040"}}))}),[o,c,n,i]);return r.a.createElement(r.a.Fragment,null,u.map((function(e,n){return r.a.createElement("mesh",{key:t+n,position:e.pt},r.a.createElement("sphereGeometry",{attach:"geometry",args:[.076]}),r.a.createElement("meshPhongMaterial",{attach:"material",color:e.color}))})))};var g=function(e){var t=e.fromNode,n=e.toNode,o=e.messages,c=e.points,u=e.duration,l=e.elapsed,g=e.onEgress,p=Object(a.useCallback)((function(e){return g(t,n,e)}),[t,n,g]),b=Object(a.useState)(0),v=Object(i.a)(b,2),y=v[0],w=v[1];Object(s.b)((function(e){var t=e.clock;w(t.elapsedTime)}));var O=function(e,t,n,r){var o=Object(a.useState)(void 0),c=Object(i.a)(o,2),u=c[0],s=c[1];Object(a.useEffect)((function(){e&&0!==e.length&&s((function(t){return[].concat(Object(h.a)(t||[]),Object(h.a)(e))}))}),[e,t]);var l=Object(a.useMemo)((function(){if(!u||0===u.length)return[];var e=u[0];return n>=e.frame+t?u.filter((function(e){return n<e.frame+t})):u}),[u,t,n]),d=Object(a.useMemo)((function(){var e=[];if(!u||0===u.length)return e;var a=u[0];return n>=a.frame+t?u.filter((function(e){return n>=e.frame+t})):e}),[u,t,n]);return Object(a.useEffect)((function(){if(d&&0!==d.length){var e=Object(m.keyBy)(d,(function(e){return e.messageKey}));s((function(t){return(t||[]).filter((function(t){return!e[t.messageKey]}))}))}}),[d]),Object(a.useEffect)((function(){d&&0!==d.length&&r(d)}),[t,d,r]),l}(o,u,l,p),j=function(e){return Object(a.useMemo)((function(){return new d.CatmullRomCurve3(e,!1,"catmullrom")}),[e])}(c);return r.a.createElement(r.a.Fragment,null,r.a.createElement("mesh",{key:"".concat(t.name,"-").concat(n.name,"-edge")},r.a.createElement("tubeGeometry",{attach:"geometry",args:[j,80,.03,8,!1]}),r.a.createElement("meshPhongMaterial",{attach:"material",color:"#333"})),r.a.createElement(f,{key:"".concat(t.name,"-").concat(n.name,"-messages"),elapsed:y,prefix:"".concat(t.name,"-").concat(n.name,"-messages"),curve:j,duration:u,messages:O}))},p=n(29),b=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?1-(e/Math.abs(e)+1)/2:(e/Math.abs(e)+1)/2},v=function(e,t,n,a,r){var o=t[3*n+2]<0,c=b(t[3*n],o),i=b(t[3*n+1],!1),u=b(t[3*a],o),s=b(t[3*a+1],!1),l=b(t[3*r],o),m=b(t[3*r+1],!1);return[new d.Vector2(c,i),new d.Vector2(u,s),new d.Vector2(l,m)]},y=function(e,t,n,a,r,o){var c=e.parameters.options.depth,i=e.parameters.shapes.curves,u=i.reduce((function(e,t){return[Math.min(e[0],t.v1.x,t.v2.x),Math.max(e[1],t.v1.x,t.v2.x)]}),[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER]),s=i.reduce((function(e,t){return[Math.min(e[0],t.v1.y,t.v2.y),Math.max(e[1],t.v1.y,t.v2.y)]}),[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER]),l=[0,c],m=function(e,t){return(e-t[0])/(t[1]-t[0])},h=m(t[3*n],u),f=m(t[3*n+1],s),g=m(t[3*n+2],l),p=m(t[3*a],u),b=m(t[3*a+1],s),v=m(t[3*a+2],l),y=(m(t[3*r],u),m(t[3*r+1],s)),w=m(t[3*r+2],l),O=(m(t[3*o],u),m(t[3*o+1],s)),j=m(t[3*o+2],l);if(Math.abs(h-p)<.01){var x=function(e){return h>.5?1-e:e};return[new d.Vector2(x(g),f),new d.Vector2(x(v),b),new d.Vector2(x(w),y),new d.Vector2(x(j),O)]}return[new d.Vector2(0,0),new d.Vector2(0,0),new d.Vector2(0,0),new d.Vector2(0,0)]},w=Object(a.forwardRef)((function(e,t){var n=e.width,o=e.height,c=e.text,i=e.backgroundColor,u=e.color,s=e.depth,l=e.onClick,m=e.position,h=Object(p.a)(e,["width","height","text","backgroundColor","color","depth","onClick","position"]),f=n,g=o,b=c,w=Object(a.useMemo)((function(){var e=new d.Shape;return e.moveTo(f/2*-1,g/2*-1),e.lineTo(f/2,g/2*-1),e.lineTo(f/2,g/2),e.lineTo(f/2*-1,g/2),e.lineTo(f/2*-1,g/2*-1),e}),[f,g]),O=Object(a.useMemo)((function(){return{steps:2,depth:s,bevelEnabled:!0,bevelThickness:.03,bevelSize:.02,bevelOffset:0,bevelSegments:5,UVGenerator:{generateTopUV:v,generateSideWallUV:y}}}),[s]),j=Object(a.useMemo)((function(){var e=document.createElement("canvas"),t=e.getContext("2d");if(!t)return null;var n=20*f,a=20*g;e.style.position="absolute",e.style.top="calc(50% - ".concat(a/2,"px)"),e.style.width=n+"px",e.style.height=a+"px",e.width=20*n,e.height=20*a,t.scale(20,20),t.fillStyle=i||"grey",t.fillRect(0,0,n,a);var r=a/1.8;t.font="bold ".concat(r,"px Arial, sans-serif"),t.fillStyle=u||"white",t.textAlign="center",t.textBaseline="middle";var o=n/2,c=a/2;return t.fillText(b,o,c),e}),[f,g,u,i,b]),x=Object(a.useCallback)((function(e){l({text:c})}),[c,l]);return r.a.createElement("mesh",Object.assign({ref:t,onClick:x,position:m},h),r.a.createElement("boxBufferGeometry",{args:[f,g,s],attach:"geometry"}),r.a.createElement("extrudeGeometry",{attach:"geometry",args:[w,O]}),r.a.createElement("meshStandardMaterial",{roughness:.2,metalness:.8,attachArray:"material"},r.a.createElement("canvasTexture",{attach:"map",image:j})),r.a.createElement("meshStandardMaterial",{roughness:.2,metalness:.8,attachArray:"material"},r.a.createElement("canvasTexture",{attach:"map",image:j})))}));w.defaultProps={depth:.04,width:1,height:.3,text:"<null>"};var O=function(e){var t=e.name,n=e.position,o=e.width,c=e.height,i=e.depth,u=e.onSelect,s=Object(a.useCallback)((function(e){var t=e.text;return u({name:t})}),[u]);return r.a.createElement(w,{key:t,onClick:s,text:t,color:"#202020",width:o,height:.25*c,backgroundColor:"#a0a0ff",depth:i,position:new d.Vector3(n.x,n.y,n.z-i/2)})},j=function(e){var t=e.edges;return r.a.createElement(r.a.Fragment,null,t.map((function(e){return r.a.createElement(g,Object.assign({key:"".concat(e.fromNode.name,"-").concat(e.toNode.name,"-edge")},e))})))},x=function(e){var t=e.name,n=e.onSelect,o=e.width,c=e.height,l=e.depth,m=e.position,d=e.messages,h=e.edges,f=e.onEgress,g=function(e,t,n,r,o){return Object(a.useMemo)((function(){return e.map((function(e){return Object(u.a)({},e,{duration:e.duration,fromNode:{name:t},messages:n,elapsed:r,onEgress:o})}))}),[e,t,r,n,o])}(h,t,d,function(e){var t=Object(a.useState)(0),n=Object(i.a)(t,2),r=n[0],o=n[1];return Object(s.b)((function(e){var t=e.clock;o(Math.floor(100*t.elapsedTime)/100)})),r}(),f);return r.a.createElement(r.a.Fragment,null,r.a.createElement(O,{key:"label",name:t,onSelect:n,width:o,height:c,depth:Math.abs(l),position:m}),r.a.createElement(j,{edges:g}))};function E(e,t,n){var r=n.damper,o=void 0===r?.72:r,c=n.spring,u=void 0===c?.003:c,l=Object(a.useState)({pos:{x:e.x,y:e.y,z:e.z},vel:{x:0,y:0,z:0}}),m=Object(i.a)(l,2),h=m[0],f=m[1],g=Object(a.useCallback)((function(){f((function(e){return{vel:{x:((t.x-e.pos.x)*u+e.vel.x)*o,y:((t.y-e.pos.y)*u+e.vel.y)*o,z:((t.z-e.pos.z)*u+e.vel.z)*o},pos:{x:e.pos.x+e.vel.x,y:e.pos.y+e.vel.y,z:e.pos.z+e.vel.z}}}))}),[t.x,t.y,t.z,o,u]);return Object(s.b)(g),new d.Vector3(h.pos.x,h.pos.y,h.pos.z)}var M=function(e){var t=e.targetPosition,n=e.distance,a=function(e,t){var n=t.distance,a=t.rotate,r=Object(s.c)(),o=r.clock,c=r.camera,i=o.getElapsedTime()*((a||360)/56e3*(2*Math.PI))+Math.PI/2,u=n*Math.cos(i)+e.x,l=n*Math.sin(i)+e.z,m=new d.Vector3(u,e.y,l),h=E(new d.Vector3(0,0,10),m,{spring:.006,damper:.9}),f=E(new d.Vector3(0,0,0),e,{spring:.01,damper:.85});return c.lookAt(f),c.position.set(h.x,h.y,h.z),[h.x,h.y,h.z]}(new d.Vector3(t.x,t.y,t.z),{distance:n});return r.a.createElement("perspectiveCamera",{attach:"camera",position:a,args:[45,2,1,100]})};function k(e,t,n,a){return new d.Vector3((e.x-t.x)*a,(e.y-t.y)*a,(e.z-t.z)*a-n*a/2)}function C(e,t,n,a,r){return k(e,new d.Vector3((t.width[1]+t.width[0])/2,(t.height[1]+t.height[0])/2,(t.depth[1]+t.depth[0])/2),t.depth[1]-t.depth[0],r)}function z(e){var t=Object(s.c)().viewport,n=e.width[1]-e.width[0],r=e.height[1]-e.height[0],o=e.depth[1]-e.depth[0];return Object(a.useMemo)((function(){var e=Math.max(n,r,o);return Math.min(t.height,t.width)/e}),[n,r,o,t.height,t.width])}var V=function(e){var t=e.graph,n=e.onSelectNode,o=e.selectedNode,c=e.feed,h=Object(s.c)(),f=h.clock,g=h.viewport,p=Object(a.useState)({}),b=Object(i.a)(p,2),v=b[0],y=b[1],w=z(t);Object(a.useEffect)((function(){return y((function(e){return c.filter((function(e){return!!e.to})).reduce((function(t,n){var a;return Object(u.a)({},t,Object(l.a)({},n.to,{messages:n.messages.map((function(t,a){var r;return Object(u.a)({},t,{messageKey:"".concat(t.messageKey).concat(a+(e[n.to]&&(null===(r=e[n.to])||void 0===r?void 0:r.count)||0),") "),frame:f.getElapsedTime()+a/n.messages.length*5})})),count:(e[n.to]&&(null===(a=e[n.to])||void 0===a?void 0:a.count)||0)+n.messages.length}))}),e)}))}),[c,y,f]);var O=function(e){var t=z(e),n=new d.Vector3((e.width[1]+e.width[0])/2,(e.height[1]+e.height[0])/2,(e.depth[1]+e.depth[0])/2);return Object(a.useMemo)((function(){var a=e.nodes.map((function(a){return{name:a.name,position:k(a.position,n,e.depth[1]-e.depth[0],t),width:a.width*t,height:a.height*t,depth:a.depth*t}})),r=e.edges.map((function(a){var r=a.points;return{from:a.from,to:a.to,points:r.map((function(a){return k(a,n,e.depth[1]-e.depth[0],t)}))}})),o=(e.width[1]-e.width[0])*t,c=(e.height[1]-e.height[0])*t;return{width:[-.5*o,.5*o],height:[.5*c,.5*c],nodes:a,edges:r,depth:[-15,-1]}}),[t,n,e])}(t),j=Object(a.useCallback)((function(e){var t=e.name;n({text:t})}),[n]),E=Object(a.useCallback)((function(e,t,n){y((function(a){var r;return Object(u.a)({},a,(r={},Object(l.a)(r,e.name,Object(u.a)({},a[e.name]||{count:0},{messages:void 0})),Object(l.a)(r,t.name,Object(u.a)({},a[t.name]||{count:0},{messages:n.map((function(e){return Object(u.a)({},e,{frame:f.getElapsedTime()})}))})),r))}))}),[f]),V=Object(a.useMemo)((function(){return Object(m.groupBy)(O.edges,(function(e){return e.from}))}),[O]),S=Object(a.useMemo)((function(){return O.nodes.map((function(e){var t,n=(V[e.name]||[]).map((function(e){return{points:e.points,duration:5,fromNode:{name:e.from},toNode:{name:e.to},onEgress:E}}));return{position:e.position,name:e.name,onEgress:E,width:e.width,height:e.height,depth:e.depth,onSelect:j,messages:v[e.name]&&(null===(t=v[e.name])||void 0===t?void 0:t.messages)||void 0,edges:n}}))}),[O,j,v,E,V]),N=Object(a.useMemo)((function(){var e=O.nodes.findIndex((function(e){return e.name===o}));return e>=0?e:null}),[o,O]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(M,{targetPosition:null===N?C(new d.Vector3((t.width[0]+t.width[1])/2,(t.height[0]+t.height[1])/2,(t.depth[0]+t.depth[1])/2),t,g.width,g.height,w):new d.Vector3(S[N].position.x,S[N].position.y,S[N].position.z),distance:null===o?8:4.5}),S.map((function(e,t){return r.a.createElement(x,Object.assign({key:e.name},e))})))},S=n(30),N=n.n(S),P=n(31),T=n.n(P);var R=function(e){var t=e.pumpProducer,n=e.pumpValue,o=e.nodes,c=e.edges,u=Object(a.useState)(null),l=Object(i.a)(u,2),m=l[0],h=l[1],f=function(e,t){return Object(a.useMemo)((function(){var n=N()(),a=!0,r=!1,o=void 0;try{for(var c,i=e[Symbol.iterator]();!(a=(c=i.next()).done);a=!0){var u=c.value;n.addNode(u.name,u)}}catch(C){r=!0,o=C}finally{try{a||null==i.return||i.return()}finally{if(r)throw o}}var s=!0,l=!1,m=void 0;try{for(var h,f=t[Symbol.iterator]();!(s=(h=f.next()).done);s=!0){var g=h.value;n.addLink(g.from,g.to,g)}}catch(C){l=!0,m=C}finally{try{s||null==f.return||f.return()}finally{if(l)throw m}}var p=T()(n,{gravity:-30}),b=!0,v=!1,y=void 0;try{for(var w,O=e[Symbol.iterator]();!(b=(w=O.next()).done);b=!0){var j=w.value;void 0===j.x&&void 0===j.y&&void 0===j.z||p.setNodePosition(j.name,-10*(j.x||10),j.y||500*Math.random(),j.z||0)}}catch(C){v=!0,y=C}finally{try{b||null==O.return||O.return()}finally{if(v)throw y}}for(var x=0;x<100;++x)p.step();var E=e.map((function(e){var t=p.getNodePosition(e.name),n=t.x,a=t.y,r=t.z;return{name:e.name,width:e.width,height:e.height,depth:e.depth,position:new d.Vector3(n,a,r)}})),M=t.map((function(e){var t,a,r=p.getNodePosition(e.from),o=p.getNodePosition(e.to),c=null===(t=n.getNode(e.from))||void 0===t?void 0:t.data,i=null===(a=n.getNode(e.to))||void 0===a?void 0:a.data,u=function(e,t,n){return(t-e)*n+e},s=function(e,t){return t?new d.Vector3(e.x+c.width/2,e.y,e.z):new d.Vector3(e.x-i.width/2,e.y,e.z)},l=new d.Vector3(u(r.x,o.x,.5),u(r.y,o.y,.5),u(r.z,o.z,.5)),m=s(new d.Vector3(r.x,r.y,r.z),!0),h=s(new d.Vector3(o.x,o.y,o.z),!1),f=new d.Vector3(m.x+c.width/2,u(m.y,h.y,.1),u(m.z,h.z,.1)),g=new d.Vector3(h.x-i.width/2,u(m.y,h.y,.9),u(m.z,h.z,.9));return{from:e.from,to:e.to,points:[m,f,l,g,h]}})),k=p.getGraphRect();return{nodes:E,edges:M,width:[k.x1,k.x2],height:[k.y1,k.y2],depth:[k.z1,k.z2]}}),[e,t])}(o,c),g=Object(a.useMemo)((function(){return n&&t&&n.map((function(e,t){return{messageKey:e}}))||null}),[n,t]),p=Object(a.useCallback)((function(e){h(null)}),[h]);return r.a.createElement(s.a,{pixelRatio:window.devicePixelRatio,onClickCapture:p},r.a.createElement("ambientLight",{args:[16777215,.9]}),r.a.createElement("directionalLight",{position:[6,2,15],args:[16755370,.7]}),r.a.createElement("directionalLight",{position:[-6,2,15],args:[11206570,.7]}),r.a.createElement("directionalLight",{position:[-6,2,-25],args:[11184895,.7]}),r.a.createElement("directionalLight",{position:[6,2,-25],args:[16755455,.7]}),r.a.createElement(V,{graph:f,feed:[{to:t,messages:g||[]}],selectedNode:m,onSelectNode:function(e){var t=e.text;return h(t)}}))},A=n(22),G=n.n(A),I=n(32),Q=function(e){var t=e.filename,n=Object(a.useState)(null),o=Object(i.a)(n,2),c=o[0],u=o[1],s=Object(a.useState)(null),l=Object(i.a)(s,2),m=l[0],d=l[1],h=Object(a.useRef)(null),f=Object(a.useCallback)((function(){function e(){return(e=Object(I.a)(G.a.mark((function e(){var t,n,a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0});case 3:return n=e.sent,h.current.srcObject=n,(a=new MediaRecorder(n,{mimeType:'video/webm;codecs="vp8,opus"'})).ondataavailable=function(e){return t.push(e.data)},a.onstop=function(){var e=new Blob(t,{type:t[0].type});u(URL.createObjectURL(e))},a.start(),d(a),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}h.current&&function(){e.apply(this,arguments)}()}),[h]),g=Object(a.useCallback)((function(){return m&&m.stop()}),[m]);return r.a.createElement("div",{style:{padding:2,backgroundColor:"#303030",width:120}},r.a.createElement("video",{style:{display:"hidden",width:1,height:1},ref:h}),c?r.a.createElement("a",{href:c,download:t+".webm"},"Click to Download"):m?r.a.createElement("button",{onClick:g},"Stop Recording"):r.a.createElement("button",{onClick:f},"Start Recording"))},F={width:20,height:20,depth:20},K=[Object(u.a)({name:"Producer #1"},F,{x:100}),Object(u.a)({name:"Producer #2"},F,{x:100}),Object(u.a)({name:"Producer #3"},F,{x:100}),Object(u.a)({name:"Message Queue"},F),Object(u.a)({name:"Consumer #1"},F,{x:-100}),Object(u.a)({name:"Consumer #2"},F,{x:-100}),Object(u.a)({name:"Consumer #3"},F,{x:-100}),Object(u.a)({name:"Consumer #4"},F,{x:-100}),Object(u.a)({name:"Out Queue"},F,{y:-300})],L=[{from:"Producer #1",to:"Message Queue",weight:2},{from:"Producer #2",to:"Message Queue",weight:2},{from:"Producer #3",to:"Message Queue",weight:2},{from:"Message Queue",to:"Consumer #1",weight:2},{from:"Message Queue",to:"Consumer #2",weight:2},{from:"Message Queue",to:"Consumer #3",weight:2},{from:"Message Queue",to:"Consumer #4",weight:2},{from:"Consumer #3",to:"Out Queue",weight:2}],_={backgroundColor:"black",color:"#bbb",height:25,fontWeight:"bold",margin:5},B=function(){var e=Object(a.useState)(null),t=Object(i.a)(e,2),n=t[0],o=t[1],c=Object(a.useCallback)((function(){return o({id:"Producer #1",v:["1X"]})}),[o]),u=Object(a.useCallback)((function(){return o({id:"Producer #2",v:["2X"]})}),[o]),s=Object(a.useCallback)((function(){return o({id:"Producer #3",v:["3X"]})}),[o]);return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("div",null,"DAG 3D Component"),r.a.createElement("button",{style:_,onClick:c},"Pump Producer #1"),r.a.createElement("button",{style:_,onClick:u},"Pump Producer #2"),r.a.createElement("button",{style:_,onClick:s},"Pump Producer #3"),r.a.createElement("div",null,r.a.createElement(Q,{filename:"dag3d"}))),r.a.createElement(R,{pumpProducer:n&&n.id||null,pumpValue:n&&n.v,nodes:K,edges:L}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[33,1,2]]]);
//# sourceMappingURL=main.6a2f613c.chunk.js.map