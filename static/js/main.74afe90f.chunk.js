(this["webpackJsonpdag-3d"]=this["webpackJsonpdag-3d"]||[]).push([[0],{139:function(e,t,n){e.exports=n(322)},143:function(e,t,n){},144:function(e,t,n){},322:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(35),i=n.n(o),c=(n(143),n(144),n(3)),s=n(6),u=n(1),m=n(79);var l=n(2),h=n(29),f=n(28);function g(e,t,n){var r=n.damper,o=void 0===r?.72:r,i=n.spring,m=void 0===i?.003:i,l=Object(a.useState)({pos:{x:e.x,y:e.y,z:e.z},vel:{x:0,y:0,z:0}}),h=Object(c.a)(l,2),f=h[0],g=h[1],d=Object(a.useCallback)((function(){g((function(e){return{vel:{x:((t.x-e.pos.x)*m+e.vel.x)*o,y:((t.y-e.pos.y)*m+e.vel.y)*o,z:((t.z-e.pos.z)*m+e.vel.z)*o},pos:{x:e.pos.x+e.vel.x,y:e.pos.y+e.vel.y,z:e.pos.z+e.vel.z}}}))}),[t.x,t.y,t.z,o,m]);return Object(s.b)(d),new u.Vector3(f.pos.x,f.pos.y,f.pos.z)}var d=function(e){var t=e.targetPosition,n=function(e){var t=Object(s.c)().camera,n=g(new u.Vector3(0,0,10),e,{spring:.006,damper:.9}),a=g(new u.Vector3(0,0,0),new u.Vector3(e.x,e.y,e.z-6),{spring:.01,damper:.85});return t.lookAt(a),t.position.set(n.x,n.y,n.z),[n.x,n.y,n.z]}(new u.Vector3(t.x,t.y,t.z+4));return r.a.createElement("camera",{attach:"camera",position:n})},p=n(11),v=function(e){var t=e.prefix,n=e.curve,o=e.elapsed,i=e.messages,c=e.duration,s=Object(a.useMemo)((function(){return(i||[]).map((function(e){return{key:e.messageKey,pt:n.getPointAt(Math.max(0,Math.min(1,(o-e.frame)/c)))}}))}),[o,i,n,c]);return r.a.createElement(r.a.Fragment,null,s.map((function(e,n){return r.a.createElement("mesh",{key:t+n,position:e.pt},r.a.createElement("sphereGeometry",{attach:"geometry",args:[.076]}),r.a.createElement("meshPhongMaterial",{attach:"material",color:"#4070f0"}))})))};var b=function(e){var t=e.fromNode,n=e.toNode,o=e.messages,i=e.points,m=e.duration,l=e.elapsed,h=e.onEgress,g=Object(a.useCallback)((function(e){return h(t,n,e)}),[t,n,h]),d=Object(a.useState)(0),b=Object(c.a)(d,2),w=b[0],y=b[1];Object(s.b)((function(e){var t=e.clock;y(t.elapsedTime)}));var E=function(e,t,n,r){var o=Object(a.useState)(void 0),i=Object(c.a)(o,2),s=i[0],u=i[1];Object(a.useEffect)((function(){e&&0!==e.length&&u((function(t){return[].concat(Object(p.a)(t||[]),Object(p.a)(e))}))}),[e,t]);var m=Object(a.useMemo)((function(){if(!s||0===s.length)return[];var e=s[0];return n>=e.frame+t?s.filter((function(e){return n<e.frame+t})):s}),[s,t,n]),l=Object(a.useMemo)((function(){var e=[];if(!s||0===s.length)return e;var a=s[0];return n>=a.frame+t?s.filter((function(e){return n>=e.frame+t})):e}),[s,t,n]);return Object(a.useEffect)((function(){if(l&&0!==l.length){var e=Object(f.keyBy)(l,(function(e){return e.messageKey}));u((function(t){return(t||[]).filter((function(t){return!e[t.messageKey]}))}))}}),[l]),Object(a.useEffect)((function(){l&&0!==l.length&&r(l)}),[t,l,r]),m}(o,m,l,g),O=function(e){return Object(a.useMemo)((function(){return new u.CatmullRomCurve3(e,!1,"catmullrom")}),[e])}(i);return r.a.createElement(r.a.Fragment,null,r.a.createElement("mesh",{key:"".concat(t.name,"-").concat(n.name,"-edge")},r.a.createElement("tubeGeometry",{attach:"geometry",args:[O,30,.03,8,!1]}),r.a.createElement("meshPhongMaterial",{attach:"material",color:"#333"})),r.a.createElement(v,{key:"".concat(t.name,"-").concat(n.name,"-messages"),elapsed:w,prefix:"".concat(t.name,"-").concat(n.name,"-messages"),curve:O,duration:m,messages:E}))},w=n(59),y=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?1-(e/Math.abs(e)+1)/2:(e/Math.abs(e)+1)/2},E=function(e,t,n,a,r){var o=t[3*n+2]<0,i=y(t[3*n],o),c=y(t[3*n+1],!1),s=y(t[3*a],o),m=y(t[3*a+1],!1),l=y(t[3*r],o),h=y(t[3*r+1],!1);return[new u.Vector2(i,c),new u.Vector2(s,m),new u.Vector2(l,h)]},O=function(e,t,n,a,r,o){var i=e.parameters.options.depth,c=e.parameters.shapes.curves,s=c.reduce((function(e,t){return[Math.min(e[0],t.v1.x,t.v2.x),Math.max(e[1],t.v1.x,t.v2.x)]}),[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER]),m=c.reduce((function(e,t){return[Math.min(e[0],t.v1.y,t.v2.y),Math.max(e[1],t.v1.y,t.v2.y)]}),[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER]),l=[0,i],h=function(e,t){return(e-t[0])/(t[1]-t[0])},f=h(t[3*n],s),g=h(t[3*n+1],m),d=h(t[3*n+2],l),p=h(t[3*a],s),v=h(t[3*a+1],m),b=h(t[3*a+2],l),w=(h(t[3*r],s),h(t[3*r+1],m)),y=h(t[3*r+2],l),E=(h(t[3*o],s),h(t[3*o+1],m)),O=h(t[3*o+2],l);if(Math.abs(f-p)<.01){var x=function(e){return f>.5?1-e:e};return[new u.Vector2(x(d),g),new u.Vector2(x(b),v),new u.Vector2(x(y),w),new u.Vector2(x(O),E)]}return[new u.Vector2(0,0),new u.Vector2(0,0),new u.Vector2(0,0),new u.Vector2(0,0)]},x=Object(a.forwardRef)((function(e,t){var n=e.width,o=e.height,i=e.text,c=e.backgroundColor,s=e.color,m=e.depth,l=e.onClick,h=e.position,f=Object(w.a)(e,["width","height","text","backgroundColor","color","depth","onClick","position"]),g=n,d=o,p=i,v=Object(a.useMemo)((function(){var e=new u.Shape;return e.moveTo(g/2*-1,d/2*-1),e.lineTo(g/2,d/2*-1),e.lineTo(g/2,d/2),e.lineTo(g/2*-1,d/2),e.lineTo(g/2*-1,d/2*-1),e}),[g,d]),b=Object(a.useMemo)((function(){return{steps:2,depth:m,bevelEnabled:!0,bevelThickness:.03,bevelSize:.02,bevelOffset:0,bevelSegments:5,UVGenerator:{generateTopUV:E,generateSideWallUV:O}}}),[m]),y=Object(a.useMemo)((function(){var e=document.createElement("canvas"),t=e.getContext("2d");if(!t)return null;var n=20*g,a=20*d;e.style.position="absolute",e.style.top="calc(50% - ".concat(a/2,"px)"),e.style.width=n+"px",e.style.height=a+"px",e.width=20*n,e.height=20*a,t.scale(20,20),t.fillStyle=c||"grey",t.fillRect(0,0,n,a);var r=a/1.8;t.font="bold ".concat(r,"px Arial, sans-serif"),t.fillStyle=s||"white",t.textAlign="center",t.textBaseline="middle";var o=n/2,i=a/2;return t.fillText(p,o,i),e}),[g,d,s,c,p]),x=Object(a.useCallback)((function(e){l({text:i})}),[i,l]);return r.a.createElement("mesh",Object.assign({ref:t,onClick:x,position:h},f),r.a.createElement("boxBufferGeometry",{args:[g,d,m],attach:"geometry"}),r.a.createElement("extrudeGeometry",{attach:"geometry",args:[v,b]}),r.a.createElement("meshStandardMaterial",{roughness:.2,metalness:.8,attachArray:"material"},r.a.createElement("canvasTexture",{attach:"map",image:y})),r.a.createElement("meshStandardMaterial",{roughness:.2,metalness:.8,attachArray:"material"},r.a.createElement("canvasTexture",{attach:"map",image:y})))}));x.defaultProps={depth:.04,width:1,height:.3,text:"<null>"};var j=function(e){var t=e.spinX,n=e.spinY,o=Object(w.a)(e,["spinX","spinY"]),i=Object(a.useRef)(null);return Object(s.b)((function(e){var a=e.clock,r=i.current;r&&r.rotation.set(a.getElapsedTime()*(t||0),a.getElapsedTime()*(n||-0),0)})),r.a.createElement(x,Object.assign({ref:i},o))};var k=function(e){var t=e.name,n=e.onSelect,o=e.width,i=e.height,u=e.position,m=e.messages,l=e.edges,f=e.onEgress,g=Object(a.useCallback)((function(e){var t=e.text;return n({name:t})}),[n]),d=function(e){var t=Object(a.useState)(0),n=Object(c.a)(t,2),r=n[0],o=n[1];return Object(s.b)((function(e){var t=e.clock;o(Math.floor(100*t.elapsedTime)/100)})),r}(),p=Object(a.useMemo)((function(){return l.map((function(e){return Object(h.a)({},e,{fromNode:{name:t},messages:m,elapsed:d,onEgress:f})}))}),[l,t,d,m,f]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(j,{key:t,onClick:g,text:t,spinY:0,color:"#202020",width:o,height:i,backgroundColor:"#a0a0ff",depth:o,position:u}),p.map((function(e,t){return r.a.createElement(b,Object.assign({key:t},e))})))};function M(e,t,n){return(e-t[0])*n/(t[1]-t[0])-n/2}function V(e,t,n){return new u.Vector3(M(e.x,t.x,n.x),M(e.y,t.y,n.y),M(e.z,t.z,n.z))}function C(e,t,n){return e*n/(t[1]-t[0])}var S=function(e){var t=e.graph,n=e.onSelectNode,o=e.selectedNode,i=e.feed,m=Object(s.c)().clock,g=Object(a.useState)(Object(l.a)({},i.to,i.messages.map((function(e,t){return Object(h.a)({},e,{frame:m.getElapsedTime()+t/i.messages.length*5})})))),p=Object(c.a)(g,2),v=p[0],b=p[1],w=function(e){var t=Object(s.c)().viewport;return Object(a.useMemo)((function(){var n=e.nodes.map((function(n){return{name:n.name,position:V(n.position,{x:e.width,y:e.height,z:[0,5]},{x:t.width,y:t.height,z:5}),width:C(n.width||10,e.width,t.width),height:C(n.height||10,e.height,t.height),depth:C(n.width||10,e.width,5)}})),a=e.edges.map((function(n){var a=n.points;return{from:n.from,to:n.to,points:a.map((function(n){return V(n,{x:e.width,y:e.height,z:[0,5]},{x:t.width,y:t.height,z:5})}))}})),r=C(e.width[1]-e.width[0],e.width,t.width),o=C(e.height[1]-e.height[0],e.height,t.height);return{width:[r/-2,r/2],height:[o/-2,o/2],nodes:n,edges:a,depth:[0,5]}}),[5,t.width,t.height,e])}(t),y=Object(a.useCallback)((function(e){var t=e.name;n({text:t})}),[n]),E=Object(a.useCallback)((function(e,t,n){b((function(a){var r;return Object(h.a)({},a,(r={},Object(l.a)(r,e.name,void 0),Object(l.a)(r,t.name,n.map((function(e){return Object(h.a)({},e,{frame:m.getElapsedTime()})}))),r))}))}),[m]),O=Object(a.useMemo)((function(){return Object(f.groupBy)(w.edges,(function(e){return e.from}))}),[w]),x=Object(a.useMemo)((function(){return w.nodes.map((function(e){var t=(O[e.name]||[]).map((function(e){return{points:e.points,duration:5,fromNode:{name:e.from},toNode:{name:e.to},onEgress:E}}));return{position:e.position,name:e.name,onEgress:E,width:e.width||10,height:e.height||10,depth:e.width||10,onSelect:y,messages:v[e.name],edges:t}}))}),[w,y,v,E,O]),j=Object(a.useMemo)((function(){var e=w.nodes.findIndex((function(e){return e.name===o}));return e>=0?e:null}),[o,w]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(d,{targetPosition:null===j?new u.Vector3(0,0,.5):new u.Vector3(x[j].position.x,x[j].position.y,x[j].position.z)}),x.map((function(e,t){return r.a.createElement(k,Object.assign({key:e.name},e))})))},z="OMS",A="Trading Sys",N=[{name:"Ref Data Svc",width:30,height:12},{name:"EOD Prices",width:30,height:12},{name:"MD Sys",width:30,height:12},{name:"Client In",width:30,height:12},{name:"VWAP Engine",width:30,height:12},{name:z,width:30,height:12},{name:"Exch Links",width:30,height:12},{name:"Config",width:30,height:12},{name:A,width:30,height:12},{name:"Client Out",width:30,height:12}],T=[{from:"Client In",to:z,weight:2},{from:"Ref Data Svc",to:"VWAP Engine"},{from:"Config",to:"VWAP Engine",messages:1,weight:2},{from:"MD Sys",to:"VWAP Engine",messages:20,weight:2},{from:"EOD Prices",to:"VWAP Engine",messages:5},{from:"EOD Prices",to:A,messages:5},{from:"VWAP Engine",to:z,weight:2},{from:z,to:"VWAP Engine"},{from:z,to:"Exch Links"},{from:z,to:A},{from:"Exch Links",to:z,weight:2},{from:A,to:"Client Out"}],P=function(){var e=Object(a.useState)(null),t=Object(c.a)(e,2),n=t[0],o=t[1],i=function(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2],Object(a.useMemo)((function(){var n=new m.graphlib.Graph({directed:!0});n.setGraph({edgesep:100,nodesep:100,marginx:20,marginy:20,rankdir:"LR"}),n.setDefaultEdgeLabel((function(){return{}}));var a=!0,r=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done);a=!0){var s=i.value;n.setNode(s.name,{label:s.name,width:s.width,height:s.height,x:100,y:0})}}catch(E){r=!0,o=E}finally{try{a||null==c.return||c.return()}finally{if(r)throw o}}var l=!0,h=!1,f=void 0;try{for(var g,d=t[Symbol.iterator]();!(l=(g=d.next()).done);l=!0){var p=g.value;n.setEdge(p.from,p.to,{minlen:1,messages:p.messages,weight:p.weight})}}catch(E){h=!0,f=E}finally{try{l||null==d.return||d.return()}finally{if(h)throw f}}Object(m.layout)(n,{marginx:250,marginy:250});var v=n.nodes().map((function(e){return{name:e,width:n.node(e).width,height:n.node(e).height,depth:1,position:new u.Vector3(n.node(e).x,n.node(e).y,-.1)}})),b=n.edges().map((function(e){return{points:n.edge(e).points.map((function(e){return new u.Vector3(e.x,e.y,-.1)})),from:e.v,to:e.w}})),w=n.graph(),y=w.height;return{nodes:v,width:[0,w.width],height:[0,y],depth:[-20,0],edges:b}}),[e,t])}(N,T,"RL"),l=Object(a.useCallback)((function(e){o(null)}),[o]);return r.a.createElement(s.a,{pixelRatio:window.devicePixelRatio,onClickCapture:l},r.a.createElement("ambientLight",null),r.a.createElement("spotLight",{position:[6,2,15],color:new u.Color("#fff"),intensity:.8}),r.a.createElement("spotLight",{position:[-6,-2,15],color:new u.Color("#fff"),intensity:.6}),r.a.createElement(S,{graph:i,feed:{to:"Client In",messages:[{messageKey:"A"},{messageKey:"B"},{messageKey:"C"},{messageKey:"D"},{messageKey:"E"}]},selectedNode:n,onSelectNode:function(e){var t=e.text;return o(t)}}))},R=function(){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},"DAG 3D Component"),r.a.createElement(P,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[139,1,2]]]);
//# sourceMappingURL=main.74afe90f.chunk.js.map